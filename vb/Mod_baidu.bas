Attribute VB_Name = "Module"
Option Explicit
'//////////////////////////////////////////////////////////////////////////////
'@@summary
'@@require
'@@reference
'@@license
'@@author
'@@create
'@@modify
'//////////////////////////////////////////////////////////////////////////////


'//////////////////////////////////////////////////////////////////////////////
'//
'//      公有声明
'//
'//////////////////////////////////////////////////////////////////////////////


'------------------------------------------------------------------------------
'       公有常量
'------------------------------------------------------------------------------


'------------------------------------------------------------------------------
'       公有数据类型
'------------------------------------------------------------------------------


'------------------------------------------------------------------------------
'       公有变量
'------------------------------------------------------------------------------


'------------------------------------------------------------------------------
'       公有API
'------------------------------------------------------------------------------


'//////////////////////////////////////////////////////////////////////////////
'//
'//      私有声明
'//
'//////////////////////////////////////////////////////////////////////////////


'------------------------------------------------------------------------------
'       私有常量
'------------------------------------------------------------------------------


'------------------------------------------------------------------------------
'       私有数据类型
'------------------------------------------------------------------------------


'------------------------------------------------------------------------------
'       私有变量
'------------------------------------------------------------------------------


'------------------------------------------------------------------------------
'       属性变量
'------------------------------------------------------------------------------


'------------------------------------------------------------------------------
'       私有API
'------------------------------------------------------------------------------


'//////////////////////////////////////////////////////////////////////////////
'//
'//      事件处理
'//
'//////////////////////////////////////////////////////////////////////////////


'//////////////////////////////////////////////////////////////////////////////
'//
'//      私有属性
'//
'//////////////////////////////////////////////////////////////////////////////


'//////////////////////////////////////////////////////////////////////////////
'//
'//      私有方法
'//
'//////////////////////////////////////////////////////////////////////////////


'//////////////////////////////////////////////////////////////////////////////
'//
'//      公有属性
'//
'//////////////////////////////////////////////////////////////////////////////


'//////////////////////////////////////////////////////////////////////////////
'//
'//      公有方法
'//
'//////////////////////////////////////////////////////////////////////////////

Public Sub drill_url_pan(txtURL As String, title As String, Optional urlNum As Integer = 0, Optional urlItems As String)  'txtURL.Text
Dim shtm As String
Dim str1 As String
Dim str2 As String
Dim str3 As String
Dim page2url As String
Dim lastNum As String
Dim i As Integer
Dim pageURL As String
Dim linkAll As String
Dim j As Long
Dim htmTemp As String
Dim fileName As String

If txtURL = "" Then Exit Sub
shtm = getHtmlStr(txtURL)
If shtm = "" Then Exit Sub

linkAll = txtURL
urlNum = 1
str1 = "/s/ref=sr_pg_2?"
str2 = """ >2</a></span>"
page2url = Fetch(shtm, str1, str2)
If page2url = "" Then GoTo drill
str1 = "<span class=""txt"">/<b class=""page-all"">"
str2 = "</b>页</span><a href=""javascript:void(0)"" class=""page-next mou-evt"">下一页</a>"
lastNum = Fetch(shtm, str1, str2)
If lastNum = "" Then
 shtm = Replace(shtm, " ", "")
 shtm = Replace(shtm, vbCrLf, "")
 j = InStr(shtm, "<spanclass=""pagnRA"">")
 lastNum = Mid(shtm, (j - 14), 2)
 lastNum = Replace(lastNum, "<", "")
 lastNum = Replace(lastNum, ">", "")
End If
For i = 2 To Int(lastNum)
'数字替换,2替换成i
'pageURL = replace(page2url,"2",i)
str3 = "/s/ref=sr_pg_" & Trim(str(i)) & "?"
pageURL = "https://www.amazon.co.jp" & str3 & page2url
str2 = pageURL
str1 = Fetch(str2, "", "page=2") & "page="
str2 = Right(pageURL, Len(pageURL) - Len(str1) - 1)
pageURL = str1 & Trim(str(i)) & str2
pageURL = Replace(pageURL, "&amp;", "&")
linkAll = linkAll & vbCrLf & pageURL
Next i
urlNum = Int(lastNum)
drill:
fileName = title
fileName = Replace(fileName, """", "")
fileName = Replace(fileName, "'", "")
fileName = Replace(fileName, "?", "_")
fileName = Replace(fileName, "/", "_")
fileName = Replace(fileName, ":", "_")
Call writeutf8(EXEPATH & "\list\drill_" & fileName & ".txt", linkAll, "UTF-8")
Call checkURL(EXEPATH & "\list\drill_" & fileName & ".txt")
End Sub
